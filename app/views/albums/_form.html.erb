<%= form_with(model: album, class: "space-y-8") do |form| %>
  <% if album.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <h2 class="text-red-800 font-semibold mb-2">
        <%= pluralize(album.errors.count, "error") %> prohibited this album from being saved:
      </h2>
      <ul class="list-disc list-inside text-red-700">
        <% album.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Infos de base -->
  <div class="bg-white rounded-lg shadow p-6 space-y-4">
    <h3 class="text-lg font-semibold text-purple-800 mb-4">Informations de l'album</h3>
    
    <div>
      <%= form.label :name, "Nom de l'album", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_field :name, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" %>
    </div>
    
    <div>
      <%= form.label :year, "Année de publication", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.number_field :year, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" %>
    </div>
    
    <div>
      <%= form.label :description, "Description interne", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_area :description, rows: 3, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" %>
    </div>
    
    <div>
      <%= form.label :web_link, "Page de l'album (drame.org)", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_field :web_link, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" %>
    </div>
  </div>

  <!-- Pistes audio -->
  <div class="bg-white rounded-lg shadow p-6" data-controller="song-picker nested-form">
    <h3 class="text-lg font-semibold text-purple-800 mb-4">Pistes audio de l'album</h3>

    <button type="button" 
            data-action="click->song-picker#openModal"
            class="bg-purple-600 hover:bg-purple-700 text-white font-medium px-6 py-3 rounded-lg transition mb-6">
      + Ajouter une chanson
    </button>
    
    <div data-nested-form-target="container" data-controller="sortable" class="space-y-2">
      <%= form.fields_for :album_songs do |album_song_form| %>
        <%= render 'album_song_fields', form: album_song_form %>
      <% end %>
    </div>
    
    <template data-nested-form-target="template">
      <%= form.fields_for :album_songs, AlbumSong.new, child_index: 'NEW_RECORD' do |album_song_form| %>
        <%= render 'album_song_fields', form: album_song_form %>
      <% end %>
    </template>

    <!-- MODALE -->
    <div data-song-picker-target="modal" 
     style="display: none;"
     class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
      <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-auto">
        <h3 class="text-xl font-bold text-purple-800 mb-4">Rechercher une chanson</h3>
        
        <input type="text" 
               placeholder="Tapez pour rechercher..." 
               data-song-picker-target="searchInput"
               data-action="input->song-picker#search"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 mb-4">
        
        <button type="button" 
                data-action="click->song-picker#closeModal"
                class="mb-4 text-gray-600 hover:text-gray-800">
          ✕ Fermer
        </button>
        
        <div data-song-picker-target="results" class="space-y-2">
          <!-- Résultats ici -->
        </div>
      </div>
    </div>
  </div>

  <div>
    <%= form.submit "Sauvegarder", class: "bg-purple-600 hover:bg-purple-700 text-white font-medium px-6 py-3 rounded-lg transition cursor-pointer" %>
  </div>
<% end %>